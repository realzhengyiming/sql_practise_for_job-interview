# 最* 的类型题目

（1）**查出每个用户第一单的消费金额**。链接：https://www.nowcoder.com/questionTerminal/b61f123aeaad48dd8afa1937f528e5e6
来源：牛客网



用户分析是电商数据分析中重要的模块，在对用户特征深度理解和用户需求充分挖掘基础上，进行全生命周期的运营管理（拉新—>活跃—>留存—>价值提升—>忠诚），请尝试回答以下3个问题： 

  ① 用户第一单购买的行为往往反映了用户对平台的信任度和消费能力。现在数据库中有一张用户交易表order，其中有userid（用户ID）、amount（消费金额）、paytime（支付时间），请写出对应的SQL语句，**查出每个用户第一单的消费金额**。

② 当你发现本月的支付用户数环比上月大幅下跌（超30%），你会如何去探查背后的原因？请描述你的思路和其中涉及的关键指标 

  ③ 为了更好的理解用户，我们通常会基于用户的特征对用户进行分类，便于更加精细化的理解用户，设计产品和运营玩法，请你设计对应的聚类方法，包括重点的用户特征的选择及聚类算法并说明其基本原理和步骤



`select userid,amount from (select userid,amount,min(paytime) group  by userid )`



```
select a.* from
order a join (
  ``select userid, min(paytime) min_time
  ``from order group by userid
  ``) b
on a.userid = b.userid
and a.paytime = b.min_time;
```

<br>

(2)

